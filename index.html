<!DOCTYPE html>
<!-- Load in d3 library -->
<script src="https://d3js.org/d3.v4.min.js"></script>

<meta charset="utf-8">

<html lang="en">

<!-- TITLE OF WEBPAGE -->
<head>
<title> MLB Performance</title>
<link rel="stylesheet" href="css/style.css">
</head>

<!-- WEBPAGE COMPONENTS -->
<body>

<h1> Data Visualization: MLB Performance based on Pitching and Hitting for 2014 - 2018 </h1>
<p>This visualization aims to looks at Major League Baseball (MLB) statistics for the past 5 seasons including the current season.
<br>
There are many statistics in baseball that could be used to measure pitching and hitting. Though the most important ones are debatable, below we will look at two of the most important measures.
<br> For pitching, Earned Run Average (ERA) will be used which is the average number of runs allowed per 9 innings. For ERA, lower is better. 
<br> For hitting, On Base Percentage (OBP) will be used which measures how frequently a batter will reach a base. For OBP, higher is better.
<br>

<button type="button" onclick="alert('This is where the final essay will go')">About the Visualization</button>
</p>

<div id="option">
    <input name="updateButton" 
           type="button" 
           value="2014 - 2017" 
           onclick="updateData1()" />
		   
    <input name="updateButton" 
           type="button" 
           value="2018 Only" 
           onclick="updateData2()" />
</div>

<br>


<!--Create Steps for visualization-->

<div id="vis-nav">
  <a href="#" id="step1" class="step-link active">Step1</a>
  <a href="#" id="step2" class="step-link">Step2</a>
  <a href="#" id="step3" class="step-link">Step3</a>
</div>

<!--Container for visualization-->
<div id="totalviz">



<!--DIV for annotations-->  
  <div id="annotations">

    <!--Each steps annotation contained in a div-->
    <div class="annotation-step" id="step1-annotation" style="display:block;">
	
      <!--Each annotation in a separate div for positioning-->
      <div class="annotation" id="step1-left-annotation" >
        <h4>Note that the trend </h4>
        <p>Here is the annotation text for the <strong>left</strong> annotation of step 1</p>
      </div>
      
	  <div class="annotation" id="step1-right-annotation" >
        <h4>Right Annotation Title</h4>
        <p>Here is the annotation text for the <strong>right</strong> annotation of step 1</p>
      </div>
    </div>
    
	<div class="annotation-step" id="step2-annotation">
      <div class="annotation" id="step2-center-annotation" >
        <h4>Center Annotation Title</h4>
        <p>Here is the annotation text for the center annotation of step 2.<br/> 
          We are using absolute positioning of these divs</p>
      </div>
    </div>
    
	<div class="annotation-step" id="step3-annotation">
      <div class="annotation" id="step3-high-annotation" >
        <h4>High Annotation Title</h4>
        <p>This is text up high.</p>
      </div>
      <div class="annotation" id="step3-low-annotation" >
        <h4>Low Annotation Title</h4>
        <p>This is text down low.</p>
      </div>
    </div>
  
  </div>
  
  

  
<!--Vizualition DIV-->  
	<div id="vizsvg">
		<svg class="chart" id="vizchart" style="background-color:white" style="stroke:black" style="stroke-width: 0.5"></svg>
		<div id="tooltip"></div>
	</div>
	
<!--DIV for Brushed Table-->  
<! -- <div id="table">
        <table>
            <tr>
                <th>Team Name</th>
                <th>Year</th> 
                <th>Finished Rank</th> 
            </tr>
        </table>
    </div>
	
</div> -->


<!--Start JS-->

<script>

//First Scene

function updateData1(){

	d3.selectAll("svg > *").remove();
	
	// Setup dimensions
	var margin = {top: 25, right: 25, bottom: 50, left: 80},
		width = 860 - margin.right - margin.left,
		height = 620 - margin.top - margin.bottom;

	//setup axes with constant domain as data variables don't vary past specific ranges
	var x = d3.scaleLinear()
		.domain([2.5,5.6])
		.range([0,width]);
		
	var y = d3.scaleLinear()
		.domain([0.280,0.360])
		.range([height,0]);
		
	//Set color scale for categorical parameters
	var color = d3.scaleOrdinal(d3.schemeCategory10);

	//modify svg for vizualization area with standard name and appending g node
	var vizarea = d3.select("#vizchart")
		.attr("width", width + margin.left + margin.right)
		.attr("height", height + margin.top + margin.bottom)
	  .append("g")
		.attr("transform", "translate(" + margin.left + "," + margin.top + ")");
		
	//Tooltip variable
	var tooltip = d3.select("#tooltip");

	

	vizarea.selectAll("*").remove;

		  
	//Get data for 2014 - 2017
	d3.csv("mlb.csv", function(error, data) {

		if (error) throw error;
		
		data.forEach(function(d) {
			d.year = +d.year;
			d.team = d.team;
			d.teamname = d.teamname;
			d.obp = +d.obp;
			d.era = +d.era;
			d.winpct = +d.winpct;
			d.homerun = +d.homerun;
			d.battingavg = +d.battingavg;
			d.finish = d.finish;
		});
		
	// Create the circles based on the criteria
	vizarea.selectAll("circle")
		  .data(data)
		.enter().append("circle")
		  .attr("r", 8)
		  .attr("cx", function(d) { return x(d.era); })
		  .attr("cy", function(d) { return y(d.obp); })
		  .style("fill", function(d) { return color(d.finish); })
		  .on("mouseover",function(d){
			tooltip.style("opacity",1)
				.style("left", ((d3.event.pageX)+5) + "px")		
				.style("top", ((d3.event.pageY)+1) + "px")
				.html("Team: "+ (d.teamname) + "<br/>" + (d.year) + "  " + (d.finish)  + "<br/>" + "Win %: " + (d.winpct));
			})
		.on("mouseout", function() {tooltip.style("opacity",0)});
		
		
		//Add Annotation
		
		
		//Legend
	
	  var clicked = ""
  
	  var legend = vizarea.selectAll(".legend")
		.data(color.domain())
	    .enter().append("g")
		.attr("class", "legend")
		.attr("transform", function(d, i) { return "translate(0," + i * 20 + ")"; })
		.style("fill", "blue")
		.style("stroke","black");
	
	  legend.append("circle")
		.attr("r", 9)
		.style("fill", function(d) { return color(d); })
		.attr("transform", function(d, i) { 
				return "translate(" + (width -105) + "," + 40 + ")";
				})
		.on("click",function(d){
		   d3.selectAll("circle").style("opacity",1)
		   
		   if (clicked !== d){
			 d3.selectAll("circle")
			   .filter(function(e){
			   return e.finish !== d;
			 })
			   .style("opacity",0.2)
			 clicked = d
		   }
			else{
			  clicked = ""
			}
	  });
	 
	  legend.append("text")
		.attr("transform", function(d, i) { 
				return "translate(" + (width -85) + "," + 45 + ")";
				})
		.attr("font-size", "11px")
		  .text(function(d){ return d; });

	// Create the y and x axis
	vizarea.append("g")
		.call(d3.axisLeft(y));

	vizarea.append("g")
		.attr("transform", "translate(0," + height + ")")
		.call(d3.axisBottom(x));

	// Create the axes labels
	vizarea.append("text")
		  .attr("transform", "rotate(-90)")
		  .attr("y", 0 - margin.left + 10)
		  .attr("x",0 - (height / 2))
		  .attr("dy", "1em")
		  .style("text-anchor", "middle")
		  .style("color", "blue")
		  .text("ON BASE PERCENTAGE (OBP)");  	
		
	vizarea.append("text")             
		  .attr("transform", "translate(" + (width/2) + " ," + (height + margin.top + 20) + ")")
		  .style("text-anchor", "middle")
		  .style("color", "blue")
		  .text("EARNED RUN AVERAGE (ERA)");	
		
	});

	
}

//call update for first scene
updateData1();

// THIS IS WHERE THE FUNCTION WILL BEGIN TO START TRANSITIONS FROM FIRST SCENE
// THIS IS WHERE THE FUNCTION WILL BEGIN TO START TRANSITIONS FROM FIRST SCENE
// THIS IS WHERE THE FUNCTION WILL BEGIN TO START TRANSITIONS FROM FIRST SCENE
// THIS IS WHERE THE FUNCTION WILL BEGIN TO START TRANSITIONS FROM FIRST SCENE

function switchStep(newStep)
{
  d3.selectAll(".step-link").classed("active", false);
  d3.select("#" + newStep).classed("active", true);
}

function switchAnnotation(newStep)
{
  d3.selectAll(".annotation-step")
    .style("display", "none")
    .style("opacity", 0.0);

  d3.select("#" + newStep + "-annotation")
    .style("display", "block")
    .transition().delay(300).duration(500)
      .style("opacity", 1);
}

d3.selectAll("a.step-link").on("click", function(d) {
  var clickedStep = d3.select(this).attr("id");
  switchStep(clickedStep);
  switchAnnotation(clickedStep);
  return false;
});


// Update function for second scene

function updateData2(){

	d3.selectAll("svg > *").remove();

	// Setup dimensions
	var margin = {top: 25, right: 25, bottom: 50, left: 80},
		width = 860 - margin.right - margin.left,
		height = 620 - margin.top - margin.bottom;

	//setup axes with constant domain as data variables don't vary past specific ranges
	var x = d3.scaleLinear()
		.domain([2.5,5.6])
		.range([0,width]);
		
	var y = d3.scaleLinear()
		.domain([0.280,0.360])
		.range([height,0]);
		
	//Set color scale for categorical parameters
	var color = d3.scaleOrdinal(d3.schemeCategory10);

	//modify svg for vizualization area with standard name and appending g node
	var vizarea = d3.select("#vizchart")
		.attr("width", width + margin.left + margin.right)
		.attr("height", height + margin.top + margin.bottom)
	  .append("g")
		.attr("transform", "translate(" + margin.left + "," + margin.top + ")");
		
	//Tooltip variable
	var tooltip = d3.select("#tooltip");

	

	vizarea.selectAll("*").remove;

		  
	//Get data for 2018
	d3.csv("mlb2.csv", function(error, data) {

		if (error) throw error;
		
		data.forEach(function(d) {
			d.year = +d.year;
			d.team = d.team;
			d.teamname = d.teamname;
			d.obp = +d.obp;
			d.era = +d.era;
			d.winpct = +d.winpct;
			d.homerun = +d.homerun;
			d.battingavg = +d.battingavg;
			d.finish = d.finish;
		});
		
	// Create the circles based on the criteria
	vizarea.selectAll("circle")
		  .data(data)
		.enter().append("circle")
		  .attr("r", 8)
		  .attr("cx", function(d) { return x(d.era); })
		  .attr("cy", function(d) { return y(d.obp); })
		  .style("fill", function(d) { return color(d.finish); })
		  .on("mouseover",function(d){
			tooltip.style("opacity",1)
				.style("left", ((d3.event.pageX)+5) + "px")		
				.style("top", ((d3.event.pageY)+1) + "px")
				.html("Team: "+ (d.teamname) + "<br/>" + (d.year) + "  " + (d.finish)  + "<br/>" + "Win %: " + (d.winpct) );
			})
		.on("mouseout", function() {tooltip.style("opacity",0)});
		
		
	
		//Add Annotation
		//Add text labels - conflict with data1 - needs work
		vizarea.selectAll("text")
			.data(data).enter().append("text")
			.text(function(d){return d.team;})
			.attr("x", function(d) { return x(d.era)-4; })
			.attr("y", function(d) { return y(d.obp)+2; })
			.style("color","blue");	
		
		
		//Legend
	
	  var clicked = ""
  
	  var legend = vizarea.selectAll(".legend")
		.data(color.domain())
	    .enter().append("g")
		.attr("class", "legend")
		.attr("transform", function(d, i) { return "translate(0," + i * 20 + ")"; })
		.style("fill", "blue")
		.style("stroke","black");
	
	  legend.append("circle")
		.attr("r", 9)
		.style("fill", function(d) { return color(d); })
		.attr("transform", function(d, i) { 
				return "translate(" + (width -105) + "," + 40 + ")";
				})
		.on("click",function(d){
		   d3.selectAll("circle").style("opacity",1)
		   
		   if (clicked !== d){
			 d3.selectAll("circle")
			   .filter(function(e){
			   return e.finish !== d;
			 })
			   .style("opacity",0.2)
			 clicked = d
		   }
			else{
			  clicked = ""
			}
	  });
	 
	  legend.append("text")
		.attr("transform", function(d, i) { 
				return "translate(" + (width -85) + "," + 45 + ")";
				})
		.attr("font-size", "11px")
		  .text(function(d){ return d; });

	// Create the y and x axis
	vizarea.append("g")
		.call(d3.axisLeft(y));

	vizarea.append("g")
		.attr("transform", "translate(0," + height + ")")
		.call(d3.axisBottom(x));

	// Create the axes labels
	vizarea.append("text")
		  .attr("transform", "rotate(-90)")
		  .attr("y", 0 - margin.left + 10)
		  .attr("x",0 - (height / 2))
		  .attr("dy", "1em")
		  .style("text-anchor", "middle")
		  .style("color", "blue")
		  .text("ON BASE PERCENTAGE (OBP)");  	
		
	vizarea.append("text")             
		  .attr("transform", "translate(" + (width/2) + " ," + (height + margin.top + 20) + ")")
		  .style("text-anchor", "middle")
		  .style("color", "blue")
		  .text("EARNED RUN AVERAGE (ERA)");	
		
	});


	
}

	
	
</script>

</body></html>
